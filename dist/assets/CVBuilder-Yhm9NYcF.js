import{j as e,m as v}from"./motion-DEFBAXox.js";import{a as f}from"./vendor-C4jSHSwK.js";import{u as N,s as w}from"./index-DicW4zRf.js";import{F as y}from"./TrashIcon-CkYu8bNi.js";import{F as D}from"./ArrowLeftIcon-W7OVpCEa.js";import{F as E}from"./DocumentArrowDownIcon-CFaK7p-O.js";import"./i18n-DQkvtCzx.js";import"./ui-Nk6LSbPB.js";function S({template:r,onSelect:a}){return e.jsxs(v.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-white/5 rounded-lg overflow-hidden hover:bg-white/10 transition-colors cursor-pointer",onClick:a,children:[e.jsx("div",{className:"aspect-[3/4] bg-white/5"}),e.jsxs("div",{className:"p-4",children:[e.jsx("h3",{className:"text-lg font-medium text-white",children:r.name}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:r.description}),e.jsx("div",{className:"mt-2",children:e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-primary-600/20 text-primary-400",children:r.category})})]})]})}function T({content:r,onChange:a}){return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Nom complet"}),e.jsx("input",{type:"text",value:r.name,onChange:c=>a({...r,name:c.target.value}),className:"w-full bg-white/5 border border-white/10 rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-primary-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Titre professionnel"}),e.jsx("input",{type:"text",value:r.title,onChange:c=>a({...r,title:c.target.value}),className:"w-full bg-white/5 border border-white/10 rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-primary-500"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Email"}),e.jsx("input",{type:"email",value:r.email,onChange:c=>a({...r,email:c.target.value}),className:"w-full bg-white/5 border border-white/10 rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-primary-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Téléphone"}),e.jsx("input",{type:"tel",value:r.phone,onChange:c=>a({...r,phone:c.target.value}),className:"w-full bg-white/5 border border-white/10 rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-primary-500"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Localisation"}),e.jsx("input",{type:"text",value:r.location,onChange:c=>a({...r,location:c.target.value}),className:"w-full bg-white/5 border border-white/10 rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-primary-500"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"LinkedIn"}),e.jsx("input",{type:"url",value:r.linkedin,onChange:c=>a({...r,linkedin:c.target.value}),className:"w-full bg-white/5 border border-white/10 rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-primary-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Site web"}),e.jsx("input",{type:"url",value:r.website,onChange:c=>a({...r,website:c.target.value}),className:"w-full bg-white/5 border border-white/10 rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-primary-500"})]})]})]})}function _({content:r,onChange:a}){const c=()=>{const t={id:crypto.randomUUID(),title:"",company:"",location:"",startDate:"",current:!1,description:"",achievements:[]};a({items:[...r.items,t]})},d=(t,i)=>{a({items:r.items.map(s=>s.id===t?{...s,...i}:s)})},g=t=>{a({items:r.items.filter(i=>i.id!==t)})},l=t=>{a({items:r.items.map(i=>i.id===t?{...i,achievements:[...i.achievements,""]}:i)})},x=(t,i,s)=>{a({items:r.items.map(o=>o.id===t?{...o,achievements:o.achievements.map((m,h)=>h===i?s:m)}:o)})},n=(t,i)=>{a({items:r.items.map(s=>s.id===t?{...s,achievements:s.achievements.filter((o,m)=>m!==i)}:s)})};return e.jsxs("div",{className:"space-y-6",children:[r.items.map((t,i)=>e.jsxs(v.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-white/5 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("h4",{className:"text-white font-medium",children:["Expérience ",i+1]}),e.jsx("button",{onClick:()=>g(t.id),className:"text-red-400 hover:text-red-300",children:e.jsx(y,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Titre du poste"}),e.jsx("input",{type:"text",value:t.title,onChange:s=>d(t.id,{title:s.target.value}),className:"w-full bg-white/5 border border-white/10 rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-primary-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Entreprise"}),e.jsx("input",{type:"text",value:t.company,onChange:s=>d(t.id,{company:s.target.value}),className:"w-full bg-white/5 border border-white/10 rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-primary-500"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Localisation"}),e.jsx("input",{type:"text",value:t.location,onChange:s=>d(t.id,{location:s.target.value}),className:"w-full bg-white/5 border border-white/10 rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-primary-500"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Date de début"}),e.jsx("input",{type:"month",value:t.startDate,onChange:s=>d(t.id,{startDate:s.target.value}),className:"w-full bg-white/5 border border-white/10 rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-primary-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Date de fin"}),e.jsx("input",{type:"month",value:t.endDate,onChange:s=>d(t.id,{endDate:s.target.value}),disabled:t.current,className:"w-full bg-white/5 border border-white/10 rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-primary-500 disabled:opacity-50"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:`current-${t.id}`,checked:t.current,onChange:s=>d(t.id,{current:s.target.checked,endDate:s.target.checked?void 0:t.endDate}),className:"rounded border-white/10 bg-white/5 text-primary-500 focus:ring-primary-500"}),e.jsx("label",{htmlFor:`current-${t.id}`,className:"text-sm text-gray-400",children:"Poste actuel"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Description"}),e.jsx("textarea",{value:t.description,onChange:s=>d(t.id,{description:s.target.value}),rows:3,className:"w-full bg-white/5 border border-white/10 rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-primary-500"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400",children:"Réalisations"}),e.jsx("button",{onClick:()=>l(t.id),className:"text-primary-400 hover:text-primary-300",children:"+"})]}),e.jsx("div",{className:"space-y-2",children:t.achievements.map((s,o)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",value:s,onChange:m=>x(t.id,o,m.target.value),className:"flex-1 bg-white/5 border border-white/10 rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-primary-500"}),e.jsx("button",{onClick:()=>n(t.id,o),className:"text-red-400 hover:text-red-300",children:e.jsx(y,{className:"h-5 w-5"})})]},o))})]})]})]},t.id)),e.jsx("button",{onClick:c,className:"w-full py-2 border-2 border-dashed border-white/10 rounded-lg text-gray-400 hover:text-white hover:border-white/20 transition-colors",children:"Ajouter une expérience"})]})}function V({content:r,onChange:a}){const c=()=>{const l={id:crypto.randomUUID(),degree:"",school:"",location:"",startDate:"",current:!1};a({items:[...r.items,l]})},d=(l,x)=>{a({items:r.items.map(n=>n.id===l?{...n,...x}:n)})},g=l=>{a({items:r.items.filter(x=>x.id!==l)})};return e.jsxs("div",{className:"space-y-6",children:[r.items.map((l,x)=>e.jsxs(v.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-white/5 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("h4",{className:"text-white font-medium",children:["Formation ",x+1]}),e.jsx("button",{onClick:()=>g(l.id),className:"text-red-400 hover:text-red-300",children:e.jsx(y,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Diplôme"}),e.jsx("input",{type:"text",value:l.degree,onChange:n=>d(l.id,{degree:n.target.value}),className:"w-full bg-white/5 border border-white/10 rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-primary-500"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"École"}),e.jsx("input",{type:"text",value:l.school,onChange:n=>d(l.id,{school:n.target.value}),className:"w-full bg-white/5 border border-white/10 rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-primary-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Localisation"}),e.jsx("input",{type:"text",value:l.location,onChange:n=>d(l.id,{location:n.target.value}),className:"w-full bg-white/5 border border-white/10 rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-primary-500"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Date de début"}),e.jsx("input",{type:"month",value:l.startDate,onChange:n=>d(l.id,{startDate:n.target.value}),className:"w-full bg-white/5 border border-white/10 rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-primary-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Date de fin"}),e.jsx("input",{type:"month",value:l.endDate,onChange:n=>d(l.id,{endDate:n.target.value}),disabled:l.current,className:"w-full bg-white/5 border border-white/10 rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-primary-500 disabled:opacity-50"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:`current-${l.id}`,checked:l.current,onChange:n=>d(l.id,{current:n.target.checked,endDate:n.target.checked?void 0:l.endDate}),className:"rounded border-white/10 bg-white/5 text-primary-500 focus:ring-primary-500"}),e.jsx("label",{htmlFor:`current-${l.id}`,className:"text-sm text-gray-400",children:"En cours"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Description (optionnel)"}),e.jsx("textarea",{value:l.description,onChange:n=>d(l.id,{description:n.target.value}),rows:3,className:"w-full bg-white/5 border border-white/10 rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-primary-500"})]})]})]},l.id)),e.jsx("button",{onClick:c,className:"w-full py-2 border-2 border-dashed border-white/10 rounded-lg text-gray-400 hover:text-white hover:border-white/20 transition-colors",children:"Ajouter une formation"})]})}function F({content:r,onChange:a}){const c=()=>{const t={id:crypto.randomUUID(),name:"",skills:[]};a({categories:[...r.categories,t]})},d=(t,i)=>{a({categories:r.categories.map(s=>s.id===t?{...s,...i}:s)})},g=t=>{a({categories:r.categories.filter(i=>i.id!==t)})},l=t=>{a({categories:r.categories.map(i=>i.id===t?{...i,skills:[...i.skills,""]}:i)})},x=(t,i,s)=>{a({categories:r.categories.map(o=>o.id===t?{...o,skills:o.skills.map((m,h)=>h===i?s:m)}:o)})},n=(t,i)=>{a({categories:r.categories.map(s=>s.id===t?{...s,skills:s.skills.filter((o,m)=>m!==i)}:s)})};return e.jsxs("div",{className:"space-y-6",children:[r.categories.map(t=>e.jsxs("div",{className:"bg-white/5 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx("input",{type:"text",value:t.name,onChange:i=>d(t.id,{name:i.target.value}),placeholder:"Nom de la catégorie",className:"w-full bg-transparent text-white font-medium focus:outline-none"})}),e.jsx("button",{onClick:()=>g(t.id),className:"text-red-400 hover:text-red-300",children:e.jsx(y,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"space-y-2",children:[t.skills.map((i,s)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",value:i,onChange:o=>x(t.id,s,o.target.value),className:"flex-1 bg-white/5 border border-white/10 rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-primary-500"}),e.jsx("button",{onClick:()=>n(t.id,s),className:"text-red-400 hover:text-red-300",children:e.jsx(y,{className:"h-5 w-5"})})]},s)),e.jsx("button",{onClick:()=>l(t.id),className:"w-full py-2 border-2 border-dashed border-white/10 rounded-lg text-gray-400 hover:text-white hover:border-white/20 transition-colors",children:"Ajouter une compétence"})]})]},t.id)),e.jsx("button",{onClick:c,className:"w-full py-2 border-2 border-dashed border-white/10 rounded-lg text-gray-400 hover:text-white hover:border-white/20 transition-colors",children:"Ajouter une catégorie"})]})}function P({content:r,onChange:a}){const c=()=>{const t={id:crypto.randomUUID(),name:"",description:"",technologies:[],startDate:"",current:!1};a({items:[...r.items,t]})},d=(t,i)=>{a({items:r.items.map(s=>s.id===t?{...s,...i}:s)})},g=t=>{a({items:r.items.filter(i=>i.id!==t)})},l=t=>{a({items:r.items.map(i=>i.id===t?{...i,technologies:[...i.technologies,""]}:i)})},x=(t,i,s)=>{a({items:r.items.map(o=>o.id===t?{...o,technologies:o.technologies.map((m,h)=>h===i?s:m)}:o)})},n=(t,i)=>{a({items:r.items.map(s=>s.id===t?{...s,technologies:s.technologies.filter((o,m)=>m!==i)}:s)})};return e.jsxs("div",{className:"space-y-6",children:[r.items.map((t,i)=>e.jsxs("div",{className:"bg-white/5 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("h4",{className:"text-white font-medium",children:["Projet ",i+1]}),e.jsx("button",{onClick:()=>g(t.id),className:"text-red-400 hover:text-red-300",children:e.jsx(y,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Nom du projet"}),e.jsx("input",{type:"text",value:t.name,onChange:s=>d(t.id,{name:s.target.value}),className:"w-full bg-white/5 border border-white/10 rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-primary-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Description"}),e.jsx("textarea",{value:t.description,onChange:s=>d(t.id,{description:s.target.value}),rows:3,className:"w-full bg-white/5 border border-white/10 rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-primary-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"URL du projet (optionnel)"}),e.jsx("input",{type:"url",value:t.url,onChange:s=>d(t.id,{url:s.target.value}),className:"w-full bg-white/5 border border-white/10 rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-primary-500"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Date de début"}),e.jsx("input",{type:"month",value:t.startDate,onChange:s=>d(t.id,{startDate:s.target.value}),className:"w-full bg-white/5 border border-white/10 rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-primary-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Date de fin"}),e.jsx("input",{type:"month",value:t.endDate,onChange:s=>d(t.id,{endDate:s.target.value}),disabled:t.current,className:"w-full bg-white/5 border border-white/10 rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-primary-500 disabled:opacity-50"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:`current-${t.id}`,checked:t.current,onChange:s=>d(t.id,{current:s.target.checked,endDate:s.target.checked?void 0:t.endDate}),className:"rounded border-white/10 bg-white/5 text-primary-500 focus:ring-primary-500"}),e.jsx("label",{htmlFor:`current-${t.id}`,className:"text-sm text-gray-400",children:"Projet en cours"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400",children:"Technologies utilisées"}),e.jsx("button",{onClick:()=>l(t.id),className:"text-primary-400 hover:text-primary-300",children:"+"})]}),e.jsx("div",{className:"space-y-2",children:t.technologies.map((s,o)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",value:s,onChange:m=>x(t.id,o,m.target.value),className:"flex-1 bg-white/5 border border-white/10 rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-primary-500"}),e.jsx("button",{onClick:()=>n(t.id,o),className:"text-red-400 hover:text-red-300",children:e.jsx(y,{className:"h-5 w-5"})})]},o))})]})]})]},t.id)),e.jsx("button",{onClick:c,className:"w-full py-2 border-2 border-dashed border-white/10 rounded-lg text-gray-400 hover:text-white hover:border-white/20 transition-colors",children:"Ajouter un projet"})]})}function U({templateId:r,onBack:a}){const{user:c}=N(),[d,g]=f.useState([]),[l,x]=f.useState(!0),[n,t]=f.useState(!1),[i,s]=f.useState(null);f.useEffect(()=>{o()},[r]);const o=async()=>{try{x(!0);const{data:u,error:p}=await w.from("cv_templates").select("structure").eq("id",r).single();if(p)throw p;const{data:b,error:j}=await w.from("user_cvs").select("sections").eq("user_id",c?.id).eq("template_id",r).single();g(j?u.structure.sections:b.sections)}catch(u){console.error("Error loading CV:",u)}finally{x(!1)}},m=async()=>{try{t(!0),s(null);const{error:u}=await w.from("user_cvs").upsert({user_id:c?.id,template_id:r,sections:d});if(u)throw u;s({type:"success",text:"CV enregistré avec succès"})}catch(u){console.error("Error saving CV:",u),s({type:"error",text:"Erreur lors de l'enregistrement du CV"})}finally{t(!1)}},h=(u,p)=>{g(b=>b.map((j,C)=>C===u?{...j,content:p}:j))},k=(u,p)=>{switch(u.type){case"header":return e.jsx(T,{content:u.content,onChange:b=>h(p,b)});case"experience":return e.jsx(_,{content:u.content,onChange:b=>h(p,b)});case"education":return e.jsx(V,{content:u.content,onChange:b=>h(p,b)});case"skills":return e.jsx(F,{content:u.content,onChange:b=>h(p,b)});case"projects":return e.jsx(P,{content:u.content,onChange:b=>h(p,b)});default:return e.jsx("div",{className:"text-gray-400",children:"Éditeur non disponible pour cette section"})}};return l?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-primary-400"})}):e.jsxs("div",{className:"w-1/2 bg-background border-r border-white/10 p-6 overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx("button",{onClick:a,className:"p-2 text-gray-400 hover:text-white rounded-lg hover:bg-white/5",children:e.jsx(D,{className:"h-5 w-5"})}),e.jsx("h2",{className:"text-lg font-medium text-white",children:"Éditer votre CV"})]}),e.jsx("div",{className:"space-y-6",children:d.map((u,p)=>e.jsxs(v.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:p*.1},className:"card",children:[e.jsx("h3",{className:"text-white font-medium mb-4",children:u.title}),k(u,p)]},p))}),i&&e.jsx(v.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:`mt-6 rounded-lg p-4 ${i.type==="success"?"bg-green-900/50 text-green-400":"bg-red-900/50 text-red-400"}`,children:i.text}),e.jsx("div",{className:"mt-6 flex justify-end",children:e.jsx("button",{onClick:m,disabled:n,className:"btn-primary",children:n?"Enregistrement...":"Enregistrer"})})]})}function L({templateId:r}){const{user:a}=N(),[c,d]=f.useState(null),[g,l]=f.useState(!0),[x,n]=f.useState(!1);f.useEffect(()=>{t()},[r]);const t=async()=>{try{l(!0);const{data:s,error:o}=await w.from("user_cvs").select(`
          *,
          template:cv_templates(*)
        `).eq("user_id",a?.id).eq("template_id",r).single();if(o)throw o;d(s)}catch(s){console.error("Error loading CV:",s)}finally{l(!1)}},i=async()=>{try{n(!0);const o=await(await fetch("/api/generate-cv-pdf",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({cv_id:c.id})})).blob(),m=window.URL.createObjectURL(o),h=document.createElement("a");h.href=m,h.download="cv.pdf",document.body.appendChild(h),h.click(),window.URL.revokeObjectURL(m)}catch(s){console.error("Error downloading PDF:",s)}finally{n(!1)}};return g?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-primary-400"})}):e.jsxs("div",{className:"w-1/2 bg-background p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-lg font-medium text-white",children:"Aperçu"}),e.jsxs("button",{onClick:i,disabled:x,className:"btn-primary flex items-center gap-2",children:[e.jsx(E,{className:"h-5 w-5"}),x?"Téléchargement...":"Télécharger PDF"]})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-xl p-8"})]})}function H(){const[r,a]=f.useState([]),[c,d]=f.useState(null),[g,l]=f.useState(!0);f.useEffect(()=>{x()},[]);const x=async()=>{try{l(!0);const{data:n,error:t}=await w.from("cv_templates").select("*").order("name");if(t)throw t;a(n||[])}catch(n){console.error("Error loading templates:",n)}finally{l(!1)}};return g?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-primary-400"})}):c?e.jsxs("div",{className:"flex h-screen",children:[e.jsx(U,{templateId:c,onBack:()=>d(null)}),e.jsx(L,{templateId:c})]}):e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Créer votre CV"}),e.jsx("p",{className:"text-gray-400 mt-1",children:"Choisissez un modèle pour commencer"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:r.map(n=>e.jsx(S,{template:n,onSelect:()=>d(n.id)},n.id))})]})}export{H as default};
//# sourceMappingURL=CVBuilder-Yhm9NYcF.js.map
