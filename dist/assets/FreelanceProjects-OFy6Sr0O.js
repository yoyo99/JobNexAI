import{j as e,m as K}from"./motion-DEFBAXox.js";import{a as n}from"./vendor-C4jSHSwK.js";import{p as R,z as V,F as Q,s as S,b as Z}from"./index-DicW4zRf.js";import{f as v}from"./formatPrice-CNcsYbxt.js";import{_ as P}from"./ui-Nk6LSbPB.js";import{u as ee}from"./i18n-DQkvtCzx.js";import{F as te}from"./AdjustmentsHorizontalIcon-Dd7dGYQz.js";import{F as D}from"./BriefcaseIcon-DEgrI4pT.js";import{F as se}from"./BookmarkIcon-CNRvCNh2.js";import{F as re}from"./CurrencyEuroIcon-DdA5iVvH.js";import{F as ae}from"./ClockIcon-v4O1_gIX.js";import{F as le}from"./MapPinIcon-BvmDLLFD.js";function A(r,o){const a=R(r),m=R(o),c=B(a,m),f=Math.abs(V(a,m));a.setDate(a.getDate()-c*f);const x=+(B(a,m)===-c),g=c*(f-x);return g===0?0:g}function B(r,o){const a=r.getFullYear()-o.getFullYear()||r.getMonth()-o.getMonth()||r.getDate()-o.getDate()||r.getHours()-o.getHours()||r.getMinutes()-o.getMinutes()||r.getSeconds()-o.getSeconds()||r.getMilliseconds()-o.getMilliseconds();return a<0?-1:a>0?1:a}function ne({isOpen:r,onClose:o,project:a,onSubmit:m}){const[c,f]=n.useState(Math.floor((a.budget_min+a.budget_max)/2)),[x,g]=n.useState("2_weeks"),[u,y]=n.useState(""),[h,j]=n.useState(!1),p=async d=>{if(d.preventDefault(),!!u.trim())try{j(!0),await m(a.id,{bidAmount:c,deliveryTime:x,coverLetter:u})}catch(b){console.error("Error submitting proposal:",b)}finally{j(!1)}};return e.jsxs(P,{open:r,onClose:o,className:"relative z-50",children:[e.jsx("div",{className:"fixed inset-0 bg-black/75","aria-hidden":"true"}),e.jsx("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:e.jsxs(P.Panel,{className:"w-full max-w-2xl rounded-lg bg-background p-6 shadow-xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx(P.Title,{className:"text-lg font-medium text-white",children:"Proposer mes services"}),e.jsx("button",{onClick:o,className:"text-gray-400 hover:text-white transition-colors",children:e.jsx(Q,{className:"h-6 w-6"})})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-white",children:a.title}),e.jsxs("p",{className:"text-gray-400",children:["Client: ",a.client_info?.company_name||"N/A"]}),e.jsxs("p",{className:"text-gray-400",children:["Budget: ",v(a.budget_min)," - ",v(a.budget_max)]})]}),e.jsxs("form",{onSubmit:p,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Votre tarif (€)"}),e.jsx("input",{type:"number",value:c,onChange:d=>f(Number(d.target.value)),min:a.budget_min,max:a.budget_max,className:"w-full bg-white/5 border border-white/10 rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-primary-500"}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:["Proposez un montant entre ",v(a.budget_min)," et ",v(a.budget_max)]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Délai de livraison"}),e.jsxs("select",{value:x,onChange:d=>g(d.target.value),className:"w-full bg-white/5 border border-white/10 rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-primary-500",children:[e.jsx("option",{value:"1_week",children:"1 semaine"}),e.jsx("option",{value:"2_weeks",children:"2 semaines"}),e.jsx("option",{value:"1_month",children:"1 mois"}),e.jsx("option",{value:"2_months",children:"2 mois"}),e.jsx("option",{value:"3_months",children:"3 mois"}),e.jsx("option",{value:"custom",children:"Délai personnalisé"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-1",children:"Lettre de motivation"}),e.jsx("textarea",{value:u,onChange:d=>y(d.target.value),rows:6,placeholder:"Présentez-vous, expliquez pourquoi vous êtes qualifié pour ce projet et comment vous comptez l'aborder...",className:"w-full bg-white/5 border border-white/10 rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-primary-500",required:!0}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Minimum 100 caractères, maximum 2000 caractères"})]}),e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx("button",{type:"button",onClick:o,className:"btn-secondary",children:"Annuler"}),e.jsx("button",{type:"submit",disabled:h||!u.trim()||u.length<100,className:"btn-primary",children:h?"Envoi en cours...":"Envoyer ma proposition"})]})]})]})})]})}const oe=r=>[{value:"1_week",label:r("freelance.projects.durations.oneWeek")},{value:"2_weeks",label:r("freelance.projects.durations.twoWeeks")},{value:"1_month",label:r("freelance.projects.durations.oneMonth")},{value:"2_months",label:r("freelance.projects.durations.twoMonths")},{value:"3_months",label:r("freelance.projects.durations.threeMonthsPlus")}],U=r=>r==null?"":new Intl.NumberFormat("fr-FR",{style:"currency",currency:"EUR"}).format(r);function ye(){const[r,o]=n.useState([]),[a,m]=n.useState(!0),[c,f]=n.useState(""),[x,g]=n.useState([]),[u,y]=n.useState(""),[h,j]=n.useState(""),[p,d]=n.useState(null),[b,F]=n.useState(null),[M,N]=n.useState(!1),[q,_]=n.useState(!1),[C,I]=n.useState(null),[w,T]=n.useState([]),$={"Développement Web":"freelance.projects.skills.webDevelopment","Design UX/UI":"freelance.projects.skills.uxUiDesign",Rédaction:"freelance.projects.skills.copywriting",Traduction:"freelance.projects.skills.translation","Marketing Digital":"freelance.projects.skills.digitalMarketing",SEO:"freelance.projects.skills.seo","Gestion de Projet":"freelance.projects.skills.projectManagement","Développement Mobile":"freelance.projects.skills.mobileDevelopment",DevOps:"freelance.projects.skills.devOps","Data Science":"freelance.projects.skills.dataScience",Illustration:"freelance.projects.skills.illustration","Montage Vidéo":"freelance.projects.skills.videoEditing"},z=["Développement Web","Design UX/UI","Rédaction","Traduction","Marketing Digital","SEO","Gestion de Projet","Développement Mobile","DevOps","Data Science","Illustration","Montage Vidéo"],{t:s}=ee(),L=oe(s);n.useEffect(()=>{E(),W()},[c,x,u,h,p,b]);const E=n.useCallback(async()=>{m(!0);try{let t=S.from("jobs").select("*, proposals_count:project_proposals(count), client_info:profiles(company_name)").eq("status","open");if(c&&(t=t.ilike("title",`%${c}%`)),x.length>0&&(t=t.overlaps("skills_required",x)),u!==""&&(t=t.gte("budget_min",u)),h!==""&&(t=t.lte("budget_max",h)),p!==null&&(t=t.eq("remote",p)),b)switch(b){case"1_week":t=t.lte("duration_weeks",1);break;case"2_weeks":t=t.lte("duration_weeks",2).gte("duration_weeks",1);break;case"1_month":t=t.lte("duration_weeks",4).gte("duration_weeks",2);break;case"2_months":t=t.lte("duration_weeks",8).gte("duration_weeks",4);break;case"3_months":t=t.gte("duration_weeks",12);break}const{data:l,error:i}=await t.order("created_at",{ascending:!1});if(i)throw console.error("Error fetching projects:",i),i;l&&o(l)}catch{}finally{m(!1)}},[c,x,u,h,p,b]),W=async()=>{const t=localStorage.getItem("savedFreelanceProjects");t&&T(JSON.parse(t))},X=t=>{let l;w.includes(t)?l=w.filter(i=>i!==t):l=[...w,t],T(l),localStorage.setItem("savedFreelanceProjects",JSON.stringify(l))},G=t=>{g(l=>l.includes(t)?l.filter(i=>i!==t):[...l,t])},H=t=>{I(t),_(!0)},O=()=>{f(""),g([]),y(""),j(""),d(null),F(null),N(!1)},J=async(t,l)=>{m(!0);try{const{data:{user:i}}=await S.auth.getUser();if(!i)throw new Error("User not authenticated to submit a proposal.");const Y={project_id:t,freelancer_id:i.id,bid_amount:l.bidAmount,delivery_time:l.deliveryTime,cover_letter:l.coverLetter,status:"pending"},{error:k}=await S.from("project_proposals").insert([Y]);if(k){console.error("Error submitting proposal to Supabase:",k),alert(`Erreur lors de l'envoi de la proposition: ${k.message}`),m(!1);return}alert(s("freelance.projects.proposalSubmittedSuccess")),_(!1)}catch(i){console.error("Unexpected error during proposal submission:",i),alert(`Une erreur inattendue est survenue: ${i.message||"Erreur inconnue"}`)}finally{m(!1)}};return a&&r.length===0?e.jsx("div",{className:"text-center py-10 text-white",children:s("freelance.projects.loadingProjects")}):e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:s("freelance.projects.title")}),e.jsx("p",{className:"text-gray-400 mt-1",children:s("freelance.projects.findProjectsDescription")})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 mb-6",children:[e.jsxs("div",{className:"relative flex-grow",children:[e.jsx(Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),e.jsx("input",{type:"text",value:c,onChange:t=>f(t.target.value),placeholder:s("freelance.projects.searchPlaceholder"),className:"w-full bg-white/5 border border-white/10 rounded-lg pl-10 pr-4 py-2 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary-500"})]}),e.jsxs("button",{onClick:()=>N(!M),className:"btn-secondary flex items-center gap-2",children:[e.jsx(te,{className:"h-5 w-5"}),s("freelance.projects.advancedFiltersButton")]})]}),M&&e.jsx(K.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"bg-white/5 p-6 rounded-lg mb-6 overflow-hidden",children:e.jsxs("form",{onSubmit:t=>{t.preventDefault(),E()},className:"mt-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-white mb-2",children:s("profile.skills")}),e.jsx("div",{className:"flex flex-wrap gap-2",children:z.map(t=>e.jsx("button",{type:"button",onClick:()=>G(t),className:`px-3 py-1.5 text-xs rounded-full transition-colors
                      ${x.includes(t)?"bg-primary-500 text-white":"bg-white/10 text-gray-300 hover:bg-white/20"}`,children:s($[t])},t))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-white mb-2",children:s("freelance.projects.budgetFilterTitle")}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx("div",{children:e.jsx("input",{type:"number",value:u,onChange:t=>y(t.target.value?Number(t.target.value):""),placeholder:s("freelance.projects.budgetPlaceholderMin"),className:"w-full bg-white/5 border border-white/10 rounded-lg px-4 py-2 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary-500"})}),e.jsx("div",{children:e.jsx("input",{type:"number",value:h,onChange:t=>j(t.target.value?Number(t.target.value):""),placeholder:s("freelance.projects.budgetPlaceholderMax"),className:"w-full bg-white/5 border border-white/10 rounded-lg px-4 py-2 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary-500"})})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-white mb-2",children:s("freelance.projects.durationFilterTitle")}),e.jsxs("select",{value:b||"",onChange:t=>F(t.target.value||null),className:"w-full bg-white/5 border border-white/10 rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-primary-500",children:[e.jsx("option",{value:"",children:s("freelance.projects.allDurationsOption")}),L.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-white mb-2",children:s("search.jobType")}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{type:"button",onClick:()=>d(null),className:`px-4 py-2 text-sm rounded-lg transition-colors
                    ${p===null?"bg-primary-500 text-white":"bg-white/10 text-gray-300 hover:bg-white/20"}`,children:s("freelance.projects.jobTypeAll")}),e.jsx("button",{type:"button",onClick:()=>d(!0),className:`px-4 py-2 text-sm rounded-lg transition-colors
                    ${p===!0?"bg-primary-500 text-white":"bg-white/10 text-gray-300 hover:bg-white/20"}`,children:s("freelance.projects.jobTypeRemote")}),e.jsx("button",{type:"button",onClick:()=>d(!1),className:`px-4 py-2 text-sm rounded-lg transition-colors
                    ${p===!1?"bg-primary-500 text-white":"bg-white/10 text-gray-300 hover:bg-white/20"}`,children:s("freelance.projects.jobTypeOnSite")})]})]}),e.jsxs("div",{className:"flex justify-end gap-4 pt-4 border-t border-white/10",children:[e.jsx("button",{type:"button",onClick:()=>N(!1),className:"btn-ghost",children:s("freelance.projects.cancelButton")}),e.jsx("button",{type:"button",onClick:O,className:"btn-secondary",children:s("freelance.projects.resetFiltersButton")})]})]})}),a&&r.length>0&&e.jsx("div",{className:"text-center py-10 text-white",children:s("freelance.projects.updatingProjects")}),!a&&r.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(D,{className:"mx-auto h-12 w-12 text-gray-500"}),e.jsx("h3",{className:"mt-2 text-xl font-medium text-white",children:s("freelance.projects.noProjectsFoundTitle")}),e.jsx("p",{className:"mt-1 text-gray-400",children:s("freelance.projects.noProjectsFound")}),e.jsx("div",{className:"mt-6",children:e.jsx("button",{onClick:O,className:"btn-primary",children:s("freelance.projects.clearFiltersButton")})})]}),r.length>0&&e.jsx("div",{className:"space-y-6",children:r.map(t=>e.jsxs("div",{className:"bg-white/5 shadow-lg rounded-xl p-6 text-white transform hover:scale-[1.01] transition-transform duration-300 ease-out",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-primary-400 hover:text-primary-300 transition-colors",children:e.jsx("a",{href:`/freelance/projects/${t.id}`,children:t.title})}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:s("freelance.projects.publishedByXDaysAgo",{clientName:t.client_info?.company_name||s("freelance.projects.anonymousClient"),days:A(new Date,new Date(t.created_at)),count:A(new Date,new Date(t.created_at))})})]}),e.jsx("button",{onClick:()=>X(t.id),className:"text-gray-400 hover:text-primary-400 transition-colors p-1",children:w.includes(t.id)?e.jsx(se,{className:"h-6 w-6 text-primary-500"}):e.jsx(D,{className:"h-6 w-6"})})]}),e.jsx("p",{className:"mt-4 text-gray-300 text-sm leading-relaxed line-clamp-3",children:t.description}),e.jsx("div",{className:"mt-4 flex flex-wrap gap-2",children:t.skills_required.map(l=>e.jsx("span",{className:"px-3 py-1 text-xs bg-primary-500/20 text-primary-300 rounded-full",children:s($[l])},l))}),e.jsxs("div",{className:"mt-6 border-t border-white/10 pt-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-x-6 gap-y-4 text-sm",children:[e.jsxs("div",{className:"flex items-center text-gray-300",children:[e.jsx(re,{className:"h-5 w-5 mr-2 text-primary-400"}),s("freelance.projects.budgetRange",{minPrice:U(t.budget_min),maxPrice:U(t.budget_max)})]}),e.jsxs("div",{className:"flex items-center text-gray-300",children:[e.jsx(ae,{className:"h-5 w-5 mr-2 text-primary-400"}),t.duration_weeks?s("freelance.projects.durationValue",{weeks:t.duration_weeks}):s("freelance.projects.durationNotApplicable")]}),e.jsxs("div",{className:"flex items-center text-gray-300",children:[e.jsx(le,{className:"h-5 w-5 mr-2 text-primary-400"}),t.location," ",t.remote&&e.jsx("span",{className:"ml-1",children:s("freelance.projects.remoteTag")})]}),e.jsxs("div",{className:"flex items-center text-gray-300",children:[e.jsx(D,{className:"h-5 w-5 mr-2 text-primary-400"}),s("freelance.projects.proposalsCount",{count:t.proposals_count||0})]})]}),e.jsx("div",{className:"mt-6 flex justify-end",children:e.jsx("button",{onClick:()=>H(t),className:"btn-primary",children:s("freelance.projects.applyButton")})})]})]},t.id))}),C&&e.jsx(ne,{isOpen:q,onClose:()=>_(!1),project:C,onSubmit:J})]})}export{ye as default};
//# sourceMappingURL=FreelanceProjects-OFy6Sr0O.js.map
