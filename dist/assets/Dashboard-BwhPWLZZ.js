import{j as e,m as l}from"./motion-DEFBAXox.js";import{a as n}from"./vendor-C4jSHSwK.js";import{u as j,s as h,c as S,i as b,j as N,k as A,d as L}from"./index-DicW4zRf.js";import{u as v}from"./i18n-DQkvtCzx.js";import{F as q}from"./StarIcon-CqS4APUS.js";import{F as W}from"./CheckCircleIcon-DwgVqYHW.js";import{F as T}from"./PhoneIcon-L14-XtRz.js";import{F as g}from"./BriefcaseIcon-DEgrI4pT.js";import{F as z}from"./ArrowUpIcon-BtOt9Gwt.js";import{F as P}from"./CalendarIcon-BRtr-Ott.js";import{F as O}from"./BuildingOfficeIcon-BjP3N-A1.js";import{F as U}from"./MapPinIcon-BvmDLLFD.js";import"./ui-Nk6LSbPB.js";function V({title:s,titleId:i,...r},m){return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:m,"aria-labelledby":i},r),s?n.createElement("title",{id:i},s):null,n.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 13.5 12 21m0 0-7.5-7.5M12 21V3"}))}const B=n.forwardRef(V);function H({title:s,titleId:i,...r},m){return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:m,"aria-labelledby":i},r),s?n.createElement("title",{id:i},s):null,n.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.25 18 9 11.25l4.306 4.306a11.95 11.95 0 0 1 5.814-5.518l2.74-1.22m0 0-5.94-2.281m5.94 2.28-2.28 5.941"}))}const I=n.forwardRef(H),Y={application:{icon:S,color:"text-blue-400"},interview:{icon:T,color:"text-green-400"},offer:{icon:W,color:"text-primary-400"},favorite:{icon:q,color:"text-yellow-400"},status_change:{icon:I,color:"text-purple-400"}};function G(){const{user:s}=j(),{t:i}=v(),[r,m]=n.useState(!0),[o,_]=n.useState(null),[u,D]=n.useState("week");n.useEffect(()=>{s&&F()},[s,u]);const F=async()=>{if(s)try{m(!0);const a=new Date,c=new Date;switch(u){case"week":c.setDate(a.getDate()-7);break;case"month":c.setMonth(a.getMonth()-1);break;case"year":c.setFullYear(a.getFullYear()-1);break}const{data:x}=await h.from("job_applications").select("created_at, status").eq("user_id",s.id).gte("created_at",c.toISOString()),{data:w}=await h.from("job_applications").select("next_step_date, status").eq("user_id",s.id).eq("status","interviewing"),{data:k}=await h.from("job_applications").select("job:jobs (company)").eq("user_id",s.id),R=k||[],{data:$}=await h.from("job_applications").select(`
          id,
          status,
          created_at,
          job:jobs (
            id,
            title,
            company
          )
        `).eq("user_id",s.id).order("created_at",{ascending:!1}).limit(5),{data:M}=await h.from("job_favorites").select(`
          id,
          created_at,
          job:jobs (
            id,
            title,
            company
          )
        `).eq("user_id",s.id).order("created_at",{ascending:!1}).limit(5),C=[...$?.map(t=>({id:t.id,type:"application",title:t.job.title,company:t.job.company,date:t.created_at,status:t.status}))||[],...M?.map(t=>({id:t.id,type:"favorite",title:t.job.title,company:t.job.company,date:t.created_at}))||[]].sort((t,d)=>new Date(d.date).getTime()-new Date(t.date).getTime()).slice(0,10).map(t=>({...t,...Y[t.type]})),p={applications:{total:x?.length||0,thisWeek:x?.filter(t=>new Date(t.created_at)>=new Date(Date.now()-7*24*60*60*1e3)).length||0,lastWeek:x?.filter(t=>new Date(t.created_at)>=new Date(Date.now()-14*24*60*60*1e3)&&new Date(t.created_at)<new Date(Date.now()-7*24*60*60*1e3)).length||0,percentageChange:0},interviews:{upcoming:w?.filter(t=>t.next_step_date&&new Date(t.next_step_date)>new Date).length||0,completed:w?.filter(t=>t.next_step_date&&new Date(t.next_step_date)<=new Date).length||0},topCompanies:(R||[]).reduce((t,d)=>{const f=d.job&&typeof d.job=="object"?d.job.company:void 0;if(f){const y=t.find(E=>E.name===f);y?y.count++:t.push({name:f,count:1})}return t},[]).sort((t,d)=>d.count-t.count).slice(0,5),topLocations:[],averageSalary:0,responseRate:(x?.filter(t=>t.status!=="draft").length||0)/(x?.length||1)*100,recentActivity:C};p.applications.lastWeek>0&&(p.applications.percentageChange=(p.applications.thisWeek-p.applications.lastWeek)/p.applications.lastWeek*100),_(p)}catch(a){console.error("Error loading stats:",a)}finally{m(!1)}};return r?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-primary-400"})}):o?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex justify-end space-x-2",children:["week","month","year"].map(a=>e.jsx("button",{onClick:()=>D(a),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${u===a?"bg-primary-600 text-white":"bg-white/5 text-gray-400 hover:bg-white/10"}`,children:i(`dashboard.timeframe.${a}`)},a))}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsxs(l.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"card",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"p-3 rounded-lg bg-white/5",children:e.jsx(g,{className:"h-6 w-6 text-primary-400"})}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs("span",{className:`text-sm ${o.applications.percentageChange>0?"text-green-400":"text-red-400"}`,children:[o.applications.percentageChange>0?e.jsx(z,{className:"h-4 w-4 inline"}):e.jsx(B,{className:"h-4 w-4 inline"}),Math.abs(o.applications.percentageChange).toFixed(1),"%"]})})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:o.applications.total}),e.jsx("p",{className:"text-sm text-gray-400",children:i("dashboard.stats.applications")})]})]}),e.jsxs(l.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"card",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("div",{className:"p-3 rounded-lg bg-white/5",children:e.jsx(P,{className:"h-6 w-6 text-primary-400"})})}),e.jsxs("div",{className:"mt-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:o.interviews.upcoming}),e.jsx("p",{className:"text-sm text-gray-400",children:i("dashboard.stats.interviewsUpcoming")})]})]}),e.jsxs(l.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"card",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("div",{className:"p-3 rounded-lg bg-white/5",children:e.jsx(O,{className:"h-6 w-6 text-primary-400"})})}),e.jsxs("div",{className:"mt-4",children:[e.jsx("div",{className:"space-y-2",children:o.topCompanies.map((a,c)=>e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-400",children:a.name}),e.jsx("span",{className:"text-sm text-white",children:a.count})]},a.name))}),e.jsx("p",{className:"text-sm text-gray-400 mt-2",children:i("dashboard.stats.topCompanies")})]})]}),e.jsxs(l.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"card",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("div",{className:"p-3 rounded-lg bg-white/5",children:e.jsx(U,{className:"h-6 w-6 text-primary-400"})})}),e.jsxs("div",{className:"mt-4",children:[e.jsx("div",{className:"space-y-2",children:o.topLocations.map((a,c)=>e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-400",children:a.name}),e.jsx("span",{className:"text-sm text-white",children:a.count})]},a.name))}),e.jsx("p",{className:"text-sm text-gray-400 mt-2",children:i("dashboard.stats.topLocations")})]})]})]}),e.jsxs(l.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.4},className:"card",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:i("dashboard.stats.recentActivity")}),e.jsx("div",{className:"space-y-4",children:o.recentActivity.map(a=>{const c=a.icon||g;return e.jsxs("div",{className:"flex items-start gap-4 p-4 rounded-lg bg-white/5",children:[e.jsx("div",{className:`p-2 rounded-lg bg-white/5 ${a.color||"text-primary-400"}`,children:e.jsx(c,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("p",{className:"text-sm font-medium text-white truncate",children:[i(`dashboard.activity.${a.type}`),": ",a.title]}),e.jsxs("p",{className:"text-sm text-gray-400",children:[a.company,a.status&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"mx-2",children:"•"}),e.jsx("span",{className:"capitalize",children:a.status})]})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:b(new Date(a.date),"dd MMMM yyyy à HH:mm",{locale:N})})]})]},a.id)})})]})]}):null}function J(){const{user:s,subscription:i}=j();if(i?.status==="active")return null;const r=s?.trial_ends_at&&new Date(s.trial_ends_at)>new Date;return e.jsx(l.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"bg-gradient-to-r from-primary-600/20 to-secondary-600/20 rounded-lg p-6 mb-8",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"p-2 bg-primary-600/30 rounded-lg",children:e.jsx(A,{className:"h-6 w-6 text-primary-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-medium text-white",children:r?"Votre période d'essai est active":"Débloquez toutes les fonctionnalités premium"}),e.jsx("p",{className:"text-gray-300 mt-1",children:r?`Profitez de toutes les fonctionnalités premium jusqu'au ${b(new Date(s.trial_ends_at),"dd MMMM yyyy",{locale:N})}`:"Accédez à des fonctionnalités avancées pour optimiser votre recherche d'emploi"}),e.jsx("div",{className:"mt-4",children:e.jsx(L.Link,{to:"/pricing",className:"btn-primary inline-flex",children:r?"Passer au plan Pro":"Voir les plans"})})]})]})})}function le(){const{t:s}=v(),{user:i}=j();return n.useEffect(()=>{document.title=s("dashboard.documentTitle",{ns:"translation"})},[]),e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx(l.h1,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"text-2xl font-bold text-white",children:s("dashboard.welcome")}),e.jsx(l.p,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"text-gray-400 mt-1",children:s("dashboard.greeting",{name:i?.full_name||s("dashboard.userDefault")})})]}),e.jsx(J,{}),e.jsx(G,{})]})}export{le as default};
//# sourceMappingURL=Dashboard-BwhPWLZZ.js.map
