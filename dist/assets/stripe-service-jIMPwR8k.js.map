{"version":3,"file":"stripe-service-jIMPwR8k.js","sources":["../../node_modules/@stripe/stripe-js/dist/index.mjs","../../src/lib/stripe-service.ts"],"sourcesContent":["var V3_URL = 'https://js.stripe.com/v3';\nvar V3_URL_REGEX = /^https:\\/\\/js\\.stripe\\.com\\/v3\\/?(\\?.*)?$/;\nvar EXISTING_SCRIPT_MESSAGE = 'loadStripe.setLoadParameters was called but an existing Stripe.js script already exists in the document; existing script parameters will be used';\nvar findScript = function findScript() {\n  var scripts = document.querySelectorAll(\"script[src^=\\\"\".concat(V3_URL, \"\\\"]\"));\n\n  for (var i = 0; i < scripts.length; i++) {\n    var script = scripts[i];\n\n    if (!V3_URL_REGEX.test(script.src)) {\n      continue;\n    }\n\n    return script;\n  }\n\n  return null;\n};\n\nvar injectScript = function injectScript(params) {\n  var queryString = params && !params.advancedFraudSignals ? '?advancedFraudSignals=false' : '';\n  var script = document.createElement('script');\n  script.src = \"\".concat(V3_URL).concat(queryString);\n  var headOrBody = document.head || document.body;\n\n  if (!headOrBody) {\n    throw new Error('Expected document.body not to be null. Stripe.js requires a <body> element.');\n  }\n\n  headOrBody.appendChild(script);\n  return script;\n};\n\nvar registerWrapper = function registerWrapper(stripe, startTime) {\n  if (!stripe || !stripe._registerWrapper) {\n    return;\n  }\n\n  stripe._registerWrapper({\n    name: 'stripe-js',\n    version: \"3.4.1\",\n    startTime: startTime\n  });\n};\n\nvar stripePromise = null;\nvar onErrorListener = null;\nvar onLoadListener = null;\n\nvar onError = function onError(reject) {\n  return function () {\n    reject(new Error('Failed to load Stripe.js'));\n  };\n};\n\nvar onLoad = function onLoad(resolve, reject) {\n  return function () {\n    if (window.Stripe) {\n      resolve(window.Stripe);\n    } else {\n      reject(new Error('Stripe.js not available'));\n    }\n  };\n};\n\nvar loadScript = function loadScript(params) {\n  // Ensure that we only attempt to load Stripe.js at most once\n  if (stripePromise !== null) {\n    return stripePromise;\n  }\n\n  stripePromise = new Promise(function (resolve, reject) {\n    if (typeof window === 'undefined' || typeof document === 'undefined') {\n      // Resolve to null when imported server side. This makes the module\n      // safe to import in an isomorphic code base.\n      resolve(null);\n      return;\n    }\n\n    if (window.Stripe && params) {\n      console.warn(EXISTING_SCRIPT_MESSAGE);\n    }\n\n    if (window.Stripe) {\n      resolve(window.Stripe);\n      return;\n    }\n\n    try {\n      var script = findScript();\n\n      if (script && params) {\n        console.warn(EXISTING_SCRIPT_MESSAGE);\n      } else if (!script) {\n        script = injectScript(params);\n      } else if (script && onLoadListener !== null && onErrorListener !== null) {\n        var _script$parentNode;\n\n        // remove event listeners\n        script.removeEventListener('load', onLoadListener);\n        script.removeEventListener('error', onErrorListener); // if script exists, but we are reloading due to an error,\n        // reload script to trigger 'load' event\n\n        (_script$parentNode = script.parentNode) === null || _script$parentNode === void 0 ? void 0 : _script$parentNode.removeChild(script);\n        script = injectScript(params);\n      }\n\n      onLoadListener = onLoad(resolve, reject);\n      onErrorListener = onError(reject);\n      script.addEventListener('load', onLoadListener);\n      script.addEventListener('error', onErrorListener);\n    } catch (error) {\n      reject(error);\n      return;\n    }\n  }); // Resets stripePromise on error\n\n  return stripePromise[\"catch\"](function (error) {\n    stripePromise = null;\n    return Promise.reject(error);\n  });\n};\nvar initStripe = function initStripe(maybeStripe, args, startTime) {\n  if (maybeStripe === null) {\n    return null;\n  }\n\n  var stripe = maybeStripe.apply(undefined, args);\n  registerWrapper(stripe, startTime);\n  return stripe;\n}; // eslint-disable-next-line @typescript-eslint/explicit-module-boundary-types\n\nvar stripePromise$1;\nvar loadCalled = false;\n\nvar getStripePromise = function getStripePromise() {\n  if (stripePromise$1) {\n    return stripePromise$1;\n  }\n\n  stripePromise$1 = loadScript(null)[\"catch\"](function (error) {\n    // clear cache on error\n    stripePromise$1 = null;\n    return Promise.reject(error);\n  });\n  return stripePromise$1;\n}; // Execute our own script injection after a tick to give users time to do their\n// own script injection.\n\n\nPromise.resolve().then(function () {\n  return getStripePromise();\n})[\"catch\"](function (error) {\n  if (!loadCalled) {\n    console.warn(error);\n  }\n});\nvar loadStripe = function loadStripe() {\n  for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n    args[_key] = arguments[_key];\n  }\n\n  loadCalled = true;\n  var startTime = Date.now(); // if previous attempts are unsuccessful, will re-load script\n\n  return getStripePromise().then(function (maybeStripe) {\n    return initStripe(maybeStripe, args, startTime);\n  });\n};\n\nexport { loadStripe };\n","import { loadStripe } from '@stripe/stripe-js'\nimport { supabase } from './supabase'\nimport { trackError, trackEvent } from './monitoring'\n\n// Initialiser Stripe\nlet stripePromise: Promise<any> | null = null\n\nconst getStripe = () => {\n  if (!stripePromise) {\n    stripePromise = loadStripe(process.env.VITE_STRIPE_PUBLIC_KEY!)\n  }\n  return stripePromise\n}\n\nexport const StripeService = {\n  /**\n   * Crée une session de paiement Stripe Checkout\n   */\n  async createCheckoutSession(userId: string, priceId: string, userType: 'candidate' | 'freelancer' | 'recruiter') {\n    try {\n      // Appeler la fonction Edge pour créer une session Checkout\n      const { data, error } = await supabase.functions.invoke('create-checkout-session', {\n        body: { \n          priceId, \n          userId,\n          userType\n        }\n      })\n\n      if (error) throw error\n\n      const { sessionId } = data\n      \n      // Rediriger vers Stripe Checkout\n      const stripe = await getStripe()\n      const { error: stripeError } = await stripe.redirectToCheckout({ sessionId })\n      \n      if (stripeError) throw stripeError\n\n      trackEvent('subscription.checkout.started', {\n        userId,\n        priceId,\n        userType\n      })\n\n      return { success: true, error: null }\n    } catch (error: any) {\n      trackError(error, { context: 'stripe.checkout' })\n      return { \n        success: false, \n        error: error.message || 'Une erreur est survenue lors de la création de la session de paiement'\n      }\n    }\n  },\n\n  /**\n   * Crée une session de portail client Stripe\n   */\n  async createPortalSession(customerId: string) {\n    try {\n      // Appeler la fonction Edge pour créer une session de portail\n      const { data, error } = await supabase.functions.invoke('create-portal-session', {\n        body: { customerId }\n      })\n\n      if (error) throw error\n\n      // Rediriger vers le portail client\n      window.location.href = data.url\n\n      trackEvent('subscription.portal.opened', {\n        customerId\n      })\n\n      return { success: true, error: null }\n    } catch (error: any) {\n      trackError(error, { context: 'stripe.portal' })\n      return { \n        success: false, \n        error: error.message || 'Une erreur est survenue lors de la création de la session de portail'\n      }\n    }\n  },\n\n  /**\n   * Vérifie le statut d'une session de paiement\n   */\n  async checkSessionStatus(sessionId: string) {\n    try {\n      const { data, error } = await supabase.functions.invoke('check-session-status', {\n        body: { sessionId }\n      })\n\n      if (error) throw error\n\n      trackEvent('subscription.checkout.completed', {\n        sessionId,\n        status: data.status\n      })\n\n      return { success: true, data, error: null }\n    } catch (error: any) {\n      trackError(error, { context: 'stripe.check_session' })\n      return { \n        success: false, \n        data: null,\n        error: error.message || 'Une erreur est survenue lors de la vérification de la session'\n      }\n    }\n  }\n}"],"names":["V3_URL","V3_URL_REGEX","findScript","scripts","i","script","injectScript","params","queryString","headOrBody","registerWrapper","stripe","startTime","stripePromise","onErrorListener","onLoadListener","onError","reject","onLoad","resolve","loadScript","_script$parentNode","error","initStripe","maybeStripe","args","stripePromise$1","loadCalled","getStripePromise","loadStripe","_len","_key","getStripe","define_process_env_default","StripeService","userId","priceId","userType","data","supabase","sessionId","stripeError","trackEvent","trackError","customerId"],"mappings":"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","x_google_ignoreList":[0]}