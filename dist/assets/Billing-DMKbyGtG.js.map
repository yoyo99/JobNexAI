{"version":3,"file":"Billing-DMKbyGtG.js","sources":["../../src/components/InvoiceHistory.tsx","../../src/components/BillingHistory.tsx","../../src/components/Billing.tsx"],"sourcesContent":["import { useState, useEffect } from 'react'\nimport { motion } from 'framer-motion'\nimport { useAuth } from '../stores/auth'\nimport { supabase } from '../lib/supabase'\nimport { format } from 'date-fns'\nimport { fr } from 'date-fns/locale'\nimport { DocumentArrowDownIcon } from '@heroicons/react/24/outline'\n\ninterface Invoice {\n  id: string\n  number: string\n  amount_paid: number\n  currency: string\n  status: string\n  created: number\n  hosted_invoice_url: string\n  pdf: string\n}\n\nexport function InvoiceHistory() {\n  const { user } = useAuth()\n  const [invoices, setInvoices] = useState<Invoice[]>([])\n  const [loading, setLoading] = useState(true)\n  const [error, setError] = useState<string | null>(null)\n\n  useEffect(() => {\n    if (user) {\n      loadInvoices()\n    }\n  }, [user])\n\n  const loadInvoices = async () => {\n    try {\n      setLoading(true)\n      setError(null)\n\n      const { data, error } = await supabase.functions.invoke('list-invoices', {\n        body: { userId: user?.id }\n      })\n\n      if (error) throw error\n      setInvoices(data || [])\n    } catch (error: any) {\n      console.error('Error loading invoices:', error)\n      setError(error.message || 'Une erreur est survenue')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  const formatCurrency = (amount: number, currency: string) => {\n    return new Intl.NumberFormat('fr-FR', {\n      style: 'currency',\n      currency: currency.toUpperCase(),\n    }).format(amount / 100)\n  }\n\n  if (loading) {\n    return (\n      <div className=\"flex justify-center py-6\">\n        <div className=\"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-primary-400\"></div>\n      </div>\n    )\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      <h3 className=\"text-lg font-medium text-white\">Historique des factures</h3>\n\n      {error && (\n        <div className=\"bg-red-900/50 text-red-400 p-4 rounded-lg\">\n          {error}\n        </div>\n      )}\n\n      {invoices.length === 0 ? (\n        <div className=\"bg-white/5 rounded-lg p-6 text-center\">\n          <p className=\"text-gray-400\">Aucune facture disponible</p>\n        </div>\n      ) : (\n        <div className=\"overflow-x-auto\">\n          <table className=\"min-w-full divide-y divide-white/10\">\n            <thead>\n              <tr>\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider\">\n                  Numéro\n                </th>\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider\">\n                  Date\n                </th>\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider\">\n                  Montant\n                </th>\n                <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider\">\n                  Statut\n                </th>\n                <th className=\"px-6 py-3 text-right text-xs font-medium text-gray-400 uppercase tracking-wider\">\n                  Actions\n                </th>\n              </tr>\n            </thead>\n            <tbody className=\"divide-y divide-white/10\">\n              {invoices.map((invoice) => (\n                <tr key={invoice.id}>\n                  <td className=\"px-6 py-4 whitespace-nowrap text-sm text-white\">\n                    {invoice.number}\n                  </td>\n                  <td className=\"px-6 py-4 whitespace-nowrap text-sm text-white\">\n                    {format(new Date(invoice.created * 1000), 'dd MMMM yyyy', { locale: fr })}\n                  </td>\n                  <td className=\"px-6 py-4 whitespace-nowrap text-sm text-white\">\n                    {formatCurrency(invoice.amount_paid, invoice.currency)}\n                  </td>\n                  <td className=\"px-6 py-4 whitespace-nowrap text-sm\">\n                    <span className={`px-2 py-1 rounded-full text-xs font-medium ${\n                      invoice.status === 'paid' ? 'bg-green-900/50 text-green-400' :\n                      invoice.status === 'open' ? 'bg-yellow-900/50 text-yellow-400' :\n                      'bg-red-900/50 text-red-400'\n                    }`}>\n                      {invoice.status === 'paid' ? 'Payée' :\n                       invoice.status === 'open' ? 'En attente' :\n                       'Non payée'}\n                    </span>\n                  </td>\n                  <td className=\"px-6 py-4 whitespace-nowrap text-sm text-right\">\n                    <div className=\"flex justify-end gap-2\">\n                      <a\n                        href={invoice.hosted_invoice_url}\n                        target=\"_blank\"\n                        rel=\"noopener noreferrer\"\n                        className=\"text-primary-400 hover:text-primary-300\"\n                      >\n                        Voir\n                      </a>\n                      <a\n                        href={invoice.pdf}\n                        target=\"_blank\"\n                        rel=\"noopener noreferrer\"\n                        className=\"text-primary-400 hover:text-primary-300 flex items-center gap-1\"\n                      >\n                        <DocumentArrowDownIcon className=\"h-4 w-4\" />\n                        PDF\n                      </a>\n                    </div>\n                  </td>\n                </tr>\n              ))}\n            </tbody>\n          </table>\n        </div>\n      )}\n    </div>\n  )\n}","import { useState } from 'react'\nimport { useAuth } from '../stores/auth'\nimport { InvoiceHistory } from './InvoiceHistory'\nimport { PaymentMethodList } from './PaymentMethodList'\n\nexport function BillingHistory() {\n  const { user } = useAuth()\n  const [activeTab, setActiveTab] = useState<'invoices' | 'payment-methods'>('invoices')\n\n  if (!user) {\n    return null\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      <h2 className=\"text-lg font-medium text-white\">Historique de facturation</h2>\n\n      <div className=\"mb-6 border-b border-white/10\">\n        <nav className=\"flex space-x-8\">\n          <button\n            onClick={() => setActiveTab('invoices')}\n            className={`py-4 px-1 border-b-2 font-medium text-sm ${\n              activeTab === 'invoices'\n                ? 'border-primary-400 text-primary-400'\n                : 'border-transparent text-gray-400 hover:text-gray-300 hover:border-gray-300'\n            }`}\n          >\n            Factures\n          </button>\n          <button\n            onClick={() => setActiveTab('payment-methods')}\n            className={`py-4 px-1 border-b-2 font-medium text-sm ${\n              activeTab === 'payment-methods'\n                ? 'border-primary-400 text-primary-400'\n                : 'border-transparent text-gray-400 hover:text-gray-300 hover:border-gray-300'\n            }`}\n          >\n            Méthodes de paiement\n          </button>\n        </nav>\n      </div>\n\n      {activeTab === 'invoices' && (\n        <div>\n          <InvoiceHistory />\n        </div>\n      )}\n\n      {activeTab === 'payment-methods' && (\n        <div>\n          <PaymentMethodList />\n        </div>\n      )}\n    </div>\n  )\n}","import { useState } from 'react'\nimport { motion } from 'framer-motion'\nimport { useAuth } from '../stores/auth'\nimport { SubscriptionManager } from './SubscriptionManager'\nimport { BillingHistory } from './BillingHistory'\nimport { StripeWebhookInfo } from './StripeWebhookInfo'\n\nfunction Billing() {\n  const { user } = useAuth()\n  const [activeTab, setActiveTab] = useState<'subscription' | 'history' | 'webhook'>('subscription')\n\n  if (!user) {\n    return null\n  }\n\n  return (\n    <div className=\"max-w-4xl mx-auto\">\n      <motion.div\n        initial={{ opacity: 0, y: 20 }}\n        animate={{ opacity: 1, y: 0 }}\n        className=\"mb-8\"\n      >\n        <h1 className=\"text-2xl font-bold text-white\">Facturation</h1>\n        <p className=\"text-gray-400 mt-1\">\n          Gérez votre abonnement et consultez votre historique de facturation\n        </p>\n      </motion.div>\n\n      <div className=\"mb-6 border-b border-white/10\">\n        <nav className=\"flex space-x-8\">\n          <button\n            onClick={() => setActiveTab('subscription')}\n            className={`py-4 px-1 border-b-2 font-medium text-sm ${\n              activeTab === 'subscription'\n                ? 'border-primary-400 text-primary-400'\n                : 'border-transparent text-gray-400 hover:text-gray-300 hover:border-gray-300'\n            }`}\n          >\n            Abonnement\n          </button>\n          <button\n            onClick={() => setActiveTab('history')}\n            className={`py-4 px-1 border-b-2 font-medium text-sm ${\n              activeTab === 'history'\n                ? 'border-primary-400 text-primary-400'\n                : 'border-transparent text-gray-400 hover:text-gray-300 hover:border-gray-300'\n            }`}\n          >\n            Historique\n          </button>\n          <button\n            onClick={() => setActiveTab('webhook')}\n            className={`py-4 px-1 border-b-2 font-medium text-sm ${\n              activeTab === 'webhook'\n                ? 'border-primary-400 text-primary-400'\n                : 'border-transparent text-gray-400 hover:text-gray-300 hover:border-gray-300'\n            }`}\n          >\n            Webhook\n          </button>\n        </nav>\n      </div>\n\n      <div className=\"card\">\n        {activeTab === 'subscription' && (\n          <motion.div\n            initial={{ opacity: 0, y: 20 }}\n            animate={{ opacity: 1, y: 0 }}\n          >\n            <SubscriptionManager />\n          </motion.div>\n        )}\n\n        {activeTab === 'history' && (\n          <motion.div\n            initial={{ opacity: 0, y: 20 }}\n            animate={{ opacity: 1, y: 0 }}\n          >\n            <BillingHistory />\n          </motion.div>\n        )}\n\n        {activeTab === 'webhook' && (\n          <motion.div\n            initial={{ opacity: 0, y: 20 }}\n            animate={{ opacity: 1, y: 0 }}\n          >\n            <StripeWebhookInfo />\n          </motion.div>\n        )}\n      </div>\n    </div>\n  )\n}\n\nexport default Billing;"],"names":["InvoiceHistory","user","useAuth","invoices","setInvoices","useState","loading","setLoading","error","setError","useEffect","loadInvoices","data","supabase","formatCurrency","amount","currency","jsx","jsxs","invoice","format","fr","DocumentArrowDownIcon","BillingHistory","activeTab","setActiveTab","PaymentMethodList","Billing","motion","SubscriptionManager","StripeWebhookInfo"],"mappings":"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"}