import{s as d,t as f,m as p}from"./index-DicW4zRf.js";var h="https://js.stripe.com/v3",g=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/;var y=function(){for(var r=document.querySelectorAll('script[src^="'.concat(h,'"]')),e=0;e<r.length;e++){var t=r[e];if(g.test(t.src))return t}return null},S=function(r){var e="",t=document.createElement("script");t.src="".concat(h).concat(e);var n=document.head||document.body;if(!n)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return n.appendChild(t),t},P=function(r,e){!r||!r._registerWrapper||r._registerWrapper({name:"stripe-js",version:"3.4.1",startTime:e})},s=null,u=null,c=null,b=function(r){return function(){r(new Error("Failed to load Stripe.js"))}},L=function(r,e){return function(){window.Stripe?r(window.Stripe):e(new Error("Stripe.js not available"))}},k=function(r){return s!==null?s:(s=new Promise(function(e,t){if(typeof window>"u"||typeof document>"u"){e(null);return}if(window.Stripe){e(window.Stripe);return}try{var n=y();if(!(n&&r)){if(!n)n=S(r);else if(n&&c!==null&&u!==null){var i;n.removeEventListener("load",c),n.removeEventListener("error",u),(i=n.parentNode)===null||i===void 0||i.removeChild(n),n=S(r)}}c=L(e,t),u=b(t),n.addEventListener("load",c),n.addEventListener("error",u)}catch(l){t(l);return}}),s.catch(function(e){return s=null,Promise.reject(e)}))},j=function(r,e,t){if(r===null)return null;var n=r.apply(void 0,e);return P(n,t),n},a,w=!1,E=function(){return a||(a=k(null).catch(function(r){return a=null,Promise.reject(r)}),a)};Promise.resolve().then(function(){return E()}).catch(function(o){w||console.warn(o)});var x=function(){for(var r=arguments.length,e=new Array(r),t=0;t<r;t++)e[t]=arguments[t];w=!0;var n=Date.now();return E().then(function(i){return j(i,e,n)})},_={};let v=null;const C=()=>(v||(v=x(_.VITE_STRIPE_PUBLIC_KEY)),v),U={async createCheckoutSession(o,r,e){try{const{data:t,error:n}=await d.functions.invoke("create-checkout-session",{body:{priceId:r,userId:o,userType:e}});if(n)throw n;const{sessionId:i}=t,l=await C(),{error:m}=await l.redirectToCheckout({sessionId:i});if(m)throw m;return f("subscription.checkout.started",{userId:o,priceId:r,userType:e}),{success:!0,error:null}}catch(t){return p(t,{context:"stripe.checkout"}),{success:!1,error:t.message||"Une erreur est survenue lors de la création de la session de paiement"}}},async createPortalSession(o){try{const{data:r,error:e}=await d.functions.invoke("create-portal-session",{body:{customerId:o}});if(e)throw e;return window.location.href=r.url,f("subscription.portal.opened",{customerId:o}),{success:!0,error:null}}catch(r){return p(r,{context:"stripe.portal"}),{success:!1,error:r.message||"Une erreur est survenue lors de la création de la session de portail"}}},async checkSessionStatus(o){try{const{data:r,error:e}=await d.functions.invoke("check-session-status",{body:{sessionId:o}});if(e)throw e;return f("subscription.checkout.completed",{sessionId:o,status:r.status}),{success:!0,data:r,error:null}}catch(r){return p(r,{context:"stripe.check_session"}),{success:!1,data:null,error:r.message||"Une erreur est survenue lors de la vérification de la session"}}}};export{U as S,x as l};
//# sourceMappingURL=stripe-service-jIMPwR8k.js.map
